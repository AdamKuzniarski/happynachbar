generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                String       @id @default(uuid()) @db.Uuid
  email             String       @unique
  passwordHash      String
  lastActiveAt      DateTime?
  profile           UserProfile?
  createdActivities Activity[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserProfile {
  userId String @id @db.Uuid
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  plz String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([plz])
}

enum ActivityStatus {
  ACTIVE
  ARCHIVED
}

enum ActivityCategory {
  OUTDOOR
  SOCIAL
  SPORT
  INDOOR
  HELP
  OTHER
}

model Activity {
  id          String           @id @default(uuid()) @db.Uuid
  title       String
  description String?
  category    ActivityCategory
  status      ActivityStatus   @default(ACTIVE)

  // Fur Feed-Filterung (plz optional in Query, aber am Activity-Datensatz wird required)

  plz String @db.VarChar(5)

  // Optional für RealTime zu arbeiten

  scheduledAt DateTime?

  // Owner / Creator (für favorites und die Rechte)
  createdById String @db.Uuid
  createdBy   User   @relation(fields: [createdById], references: [id], onDelete: Restrict)

  images ActivityImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // "Listing(createdAt, plz, status, category)" - für Filter u. Sort-Optionen
  @@index([plz, status, category, createdAt])
  @@index([createdAt])
}

model ActivityImage {
  id         String   @id @default(uuid()) @db.Uuid
  activityId String   @db.Uuid
  activity   Activity @relation(fields: [activityId], references: [id], onDelete: Cascade)

  url       String
  sortOrder Int     @default(0)
  alt       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([activityId, sortOrder]) // Innerhalb einer Activity darf keinen zweiten Datensatz mit selben sortOrder geben 
  @@index([activityId])
}
